<!DOCTYPE HTML>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="user-scalable=no, initial-scale=1.0, maximum-scale=1.0" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <title>Epsilon Mobile Framework - Version 2.0</title>
    <link href="styles/style.css" rel="stylesheet" type="text/css">
    <link href="styles/framework.css" rel="stylesheet" type="text/css">
    <link href="styles/owl.carousel.css" rel="stylesheet" type="text/css">
    <link href="styles/owl.theme.css" rel="stylesheet" type="text/css">
    <link href="styles/swipebox.css" rel="stylesheet" type="text/css">
    <link href="styles/colorbox.css" rel="stylesheet" type="text/css">
    <script type="text/javascript" src="scripts/jquery.js"></script>
    <script type="text/javascript" src="scripts/jqueryui.js"></script>
    <script type="text/javascript" src="scripts/owl.carousel.min.js"></script>
    <script type="text/javascript" src="scripts/jquery.swipebox.js"></script>
    <script type="text/javascript" src="scripts/colorbox.js"></script>
    <script type="text/javascript" src="scripts/snap.js"></script>
    <script type="text/javascript" src="scripts/contact.js"></script>
    <script type="text/javascript" src="scripts/custom.js"></script>
    <script type="text/javascript" src="scripts/framework.js"></script>
    <script type="text/javascript" src="scripts/framework.launcher.js"></script>
</head>
<body>
    <div id="loading" class="CargandoModalBackground" style="padding-top: 150px;">
        <img src="images/bx_loader.gif" alt="loding" />
    </div>
    <div id="preloader">
        <div id="status">
            <p class="center-text">
                Cargando contenido... <em>La carga depende de su conexión a internet</em>
            </p>
        </div>
    </div>
    <div class="all-elements">
         <div id="sidebar" class="page-sidebar">
            <div class="page-sidebar-scroll">
                <div class="sidebar-shortcuts">
                    <a href="#" class="shortcut-close"></a>
                </div>
                
                <div class="sidebar-search">
                    <div class="search-box">
                        <input type="text" class="search-field" name="search" onfocus="if(this.value == 'Looking for something?') { this.value = ''; }" value="Looking for something?">
                        <a href="#" class="search-close"></a>
                    </div>
                </div>
                
                <div class="sidebar-logo">
                    <img src="images/drugs/logo_odc.png" height="52" alt="img">
                </div>
                
                <div class="sidebar-breadcrumb">NAVEGACIÓN</div>
                <div class="navigation-item">
                    <a href="index.html" class="nav-item home-icon">Inicio<em class="unselected-item"></em></a>
                </div>    
                <div class="sidebar-decoration"></div>
                <div class="navigation-item">
                    <a href="listaLocales.html" class="nav-item home-sites">Listado de Locales<em class="unselected-item"></em></a>
                </div>
                <div class="sidebar-decoration"></div>
                <div class="navigation-item">
                    <a href="lista_productos_todos.html" class="nav-item home-locales">Listado de Productos<em class="unselected-item"></em></a>
                </div>
                <div class="sidebar-decoration"></div>
                <div class="navigation-item">
                    <a href="lista_mis_productos.html" class="nav-item home-compras">Mi Lista de Compras<em class="selected-item"></em></a>
                </div>   
                <div class="sidebar-decoration"></div> 
                 <div class="navigation-item">
                    <a href="lista_clientes.html" class="nav-item home-vendedor">Soy Comerciante<em class="unselected-item"></em></a>
                </div>
                <div class="sidebar-decoration"></div>         
                <div class="navigation-item">
                    <a href="faqs.html" class="nav-item home-faqs">Preguntas Frecuentes<em class="unselected-item"></em></a>
                </div>
                <div class="sidebar-decoration"></div>
                <div class="navigation-item">
                    <a href="lista_noticias.html" class="nav-item home-noticias">Noticias<em class="unselected-item"></em></a>
                </div>   
                <div class="sidebar-breadcrumb">INFORMACIÓN</div>
                
                <div class="navigation-item">
                    <a href="acerca.html" class="nav-item home-info-about">Acerca de<em class="unselected-item"></em></a>
                </div>    
     
                <div class="sidebar-breadcrumb">Actualizaciones</div>  
                
                <div class="sidebar-decoration"></div>  

                <div class="page-update">
                    <span class="update-icon"></span>
                    <a href="#" class="update-button notification-update">
                        <strong style="color: #000000;">Notificación</strong>
                        <em style="color: #000000;">Se ha agregado un nuevo producto</em>
                    </a>
                    <div class="page-update-text" style="color: #000000;">
                        Existen nuevas actualizaciones en el catálogo de datos
                    </div>
                </div>
                
                <div class="sidebar-decoration"></div>
                
                <div class="sidebar-breadcrumb">Corabastos 2014
                </div>
            </div>         
        </div>
        <div id="content" class="page-content">
            <div class="page-header">
                <a href="#" class="deploy-sidebar"></a>
                <img class="header-logo" src="images/drugs/odc-texto.png" alt="img" style="width: 172px;">
                <a href="#" class="deploy-contact"></a>
            </div>
            <div class="page-header-clear">
            </div>
            <div class="content">
                <div class="decoration">
                </div>
                <div class="container no-bottom" style="text-align: center;">
                    <h3>
                        CONOZCA NUESTROS LOCALES</h3>
                </div>
                <div class="decoration">
                </div>
                <div class="container no-bottom">
                    <div class="big-notification blue-notification">
                        <h4 class="uppercase">
                            AYUDA</h4>
                        <a href="#" class="close-big-notification">x</a>
                        <p>
                            En este módulo se encuentra el listado de productos seleccionados para realizar
                            el pedido a los locales correspondientes
                        </p>
                    </div>
                </div>
                <div class="container no-bottom">
                    <h4>
                        Listado de Productos Seleccionados</h4>
                </div>
                <div id="lista_Drogas">
                    <div class="container">
                        <div class="toggle-2">
                            <strong>No se encontró conexión a Internet</strong>
                        </div>
                    </div>
                </div>
                <div class="center-text">
                    <label id="label_registros" style="text-align: center;">
                    </label>
                </div>
                <div id="flechas_paginacion" class="oculto">
                    <a href="#" onclick="paginarAnterior()" class="vinculo_izquierda" id="flechas_paginacion_izq">
                        < Anterior</a> <a href="#" onclick="paginarSiguiente()" class="vinculo_derecha" id="flechas_paginacion_der">
                            Siguiente ></a>
                </div>
                <br />
                <div class="center-text">
                    <a href="#" class="button-icon icon-setting button-green" onclick="calcular();">Calcular</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    <a href="mapa.html" class="button-icon icon-setting button-green">Ver Mapa</a>
                </div>
                <div class="center-text">
                    <label id="label_total_extra" style="text-align: center;">
                    </label>
                </div>
                <div class="center-text">
                    <label id="label_total_primera" style="text-align: center;">
                    </label>
                    <input type="hidden" id="numeros_productos" />
                </div>
                <div class="decoration">
                </div>
                <div class="container">
                    <div class="footer-socials">
                        <a href="#" class="facebook-footer"></a><a href="#" class="goup-footer"></a><a href="#"
                            class="twitter-footer"></a>
                    </div>
                    <p class="copyright uppercase center-text no-bottom">
                        Corabastos 2014<br>
                        Todos los derechos reservados</p>
                </div>
            </div>
        </div>
    </div>
    <script type="text/javascript">
        var text2 = "";
        function restarTotal(contador) {
            $("#numeros_productos").val($("#numeros_productos").val().replace(contador + ",", ""));
            $("#produc" + contador).remove();
            localStorage["MisProductos"] = "ACELGA,CALABACIN,COLIFLOR";
            cont--;
            numero_items--;
            $('#lista_Drogas .' + pagina_actual).show();
            if (pagina_actual == ultima_pagina) {
                $('#flechas_paginacion_der').hide();
                $('#flechas_paginacion_izq').show();
            }
            else {
                $('#flechas_paginacion_der').show();
                $('#flechas_paginacion_izq').show();
            }
            items_pagina = (5 * (pagina_actual - 1)) + 1;
            if (pagina_actual == ultima_pagina) {
                items_final = numero_items;
            }
            else {
                items_final = 5 * pagina_actual;
            }
            $('#label_registros').html("Productos " + items_pagina + " a " + items_final + " de " + cont);
            calcular();
        }

        function calcular() {
            var nums = $("#numeros_productos").val().split(",");
            totalPedidoExtra = 0;
            totalPedidoPrimera = 0;
            precio = 0;
            for (var i = 0; i < nums.length; i++)
            {
                if ((i + ",").indexOf($("#numeros_productos").val())) {
                    if ($("#primera_" + i).val() != undefined) {
                        totalPedidoExtra = totalPedidoExtra + (parseFloat($("#extra_" + i).val().replace(".", "")) * $("#cantidad_" + i).val());
                        totalPedidoPrimera = totalPedidoPrimera + (parseFloat($("#primera_" + i).val().toString().replace(".", "")) * $("#cantidad_" + i).val());
                    }
                }
            }
            $("#label_total_extra").html("Total compra calidad extra: $ " + formato_numero(totalPedidoExtra, 2, ",", "."));
            $("#label_total_primera").html("Total compra calidad de primera: $ " + formato_numero(totalPedidoPrimera, 2, ",", "."));
        }

        function cargar_listaDrogasFiltrado(tipoGrano) {
            var url = "http://servicedatosabiertoscolombia.cloudapp.net/v1/corabastos/locales?$filter=\"comercializacion\"='" + tipoGrano + "'&$format=json";
            $.ajax({
                url: url,
                type: 'GET',
                dataType: 'jsonp',
                crossDomain: true,
                success: function (data) {
                    $.each(data, function (i, field) {
                        $.each(field, function (x, item) {
                            text2 += field[x].codigolocal + ",";
                            return text2;
                        });
                    });
                },
                error: function (x, y, z) {
                    if (y == "timeout") {

                    }
                }
            });
        }

        function cargar_listaDrogas() {
            var granos = new Array(10)
            granos[0] = "Bodega 1 - Local 001";
            granos[1] = "Bodega 5 - Local 031";
            granos[2] = "Bodega 8 - Local 040";
            granos[3] = "Bodega 10 - Local 001";
            granos[4] = "Bodega 16 - Local 014";

            var hortalizas = new Array(10)
            hortalizas[0] = "Bodega 26 - Local 009";
            hortalizas[1] = "Bodega 18 - Local 012";
            hortalizas[2] = "Bodega 26 - Local 022";

            var frutas = new Array(10)
            frutas[0] = "Bodega 29 - Local 001";
            frutas[1] = "Bodega 29 - Local 034";
            frutas[2] = "Bodega 30 - Local 002";

            var text2 = "";
            var texto = "";
            cont = 0;
            pagina = 1;
            numeropp = 0;
            pagina_actual = 1;
            ultima_pagina = 1;
            primera_pagina = 1;
            var contador = 1;
            var totalPedidoExtra = 0;
            var totalPedidoPrimera = 0;
            var texto_aux = "";
            var url = "http://servicedatosabiertoscolombia.cloudapp.net/v1/corabastos/boletinprecios?$format=json";
            $.ajax({
                url: url,
                type: 'GET',
                dataType: 'jsonp',
                crossDomain: true,
                success: function (data) {
                    $.each(data, function (i, field) {
                        var cant = field.length;
                        var drogas = "";
                        $.each(field, function (x, item) {
                            if (localStorage["MisProductos"].indexOf("," + field[x].producto + ",") != -1) {
                                texto += '<div id=\'produc' + cont + '\' class="container todas ' + pagina + ' ">' +
                                                    '<div class="toggle-2">' +
                                                        '<a href=\'#\' class=\'button-icon icon-trash button-red\' onclick=\'restarTotal(' + cont + ')\' style=\'float: right; margin: 5px; height: 32px; z-index: 999\'></a><a href="#" class="deploy-toggle-2">' + field[x].producto + ' - ' + field[x].preciocalidadextra + '</a>' +
                                                        '<p style=\'margin-left: 20px; margin-bottom: 10px;\'><strong style=\'float: left;\'>(' + field[x].unidad + ' - ' + field[x].cantidad + ')&nbsp;&nbsp;&nbspCantidad:&nbsp;&nbsp;&nbsp;</strong><input id=\'cantidad_' + cont + '\' type=\'text\' style=\'margin-left: 20px; width: 30px; text-align: right;\' value=\'1\' /><input id=\'extra_' + cont + '\' type=\'hidden\' style=\'margin-left: 20px; width: 30px; text-align: right;\' value=\'' + field[x].preciocalidadextra + '\' /><input id=\'primera_' + cont + '\' type=\'hidden\' style=\'margin-left: 20px; width: 30px; text-align: right;\' value=\'' + field[x].preciocalidadprimera + '\' /></p>' +
                                                        '<div class="toggle-content">' +
                                                            '<p>' +
                                                            '<strong>Tipo de Producto: </strong> ' + field[x].tipoproducto + '  ' +
                                                            '</p>' +
                                                            '<p>' +
                                                            '<strong>Presentación: </strong> ' + field[x].presentacion + '  ' +
                                                            '</p>' +
                                                            '<p>' +
                                                            '<strong>Cantidad: </strong> ' + field[x].cantidad + '  ' +
                                                            '</p>' +
                                                            '<p>' +
                                                            '<strong>Unidad: </strong> ' + field[x].unidad + '  ' +
                                                            '</p>' +
                                                            '<p>' +
                                                            '<strong>Precio calidad extra: </strong> ' + field[x].preciocalidadextra + '  ' +
                                                            '</p>' +
                                                            '<p>' +
                                                            '<strong>Precio calidad de primera: </strong> ' + field[x].preciocalidadprimera + '  ' +
                                                            '</p>' +
                                                            '<p>';
                                if (field[x].tipoproducto == "GRANOS - PROCESADOS") {
                                    text2 = granos[parseInt(Math.random() * 4)];
                                } else if (field[x].tipoproducto == "HORTALIZAS") {
                                    text2 = hortalizas[parseInt(Math.random() * 2)];
                                } else if (field[x].tipoproducto == "FRUTAS") {
                                    text2 = frutas[parseInt(Math.random() * 2)];
                                } else {
                                    text2 = "Bodega 30 - Local 034";
                                }

                                texto += '<strong>Local: </strong> ' + text2 +
                                                            '</p>' +
                                                                '<div class="one-half-responsive ">' +

                                                                    '<div class="submenu-navigation">' +
                                                                        '<div class="submenu-nav-items" style="overflow: hidden; display: block;">' +
                                                                            '</div>' +
                                                                    '</div>' +
                                                                '</div>' +
                                                        '</div>' +
                                                    '</div>' +
                                                '</div>';
                                numeropp++;
                                cont++;

                                if (numeropp == 10) {
                                    pagina++;
                                    numeropp = 0;
                                }
                                totalPedidoExtra = totalPedidoExtra + parseFloat(field[x].preciocalidadextra.replace(".", ""));
                                totalPedidoPrimera = totalPedidoPrimera + parseFloat(field[x].preciocalidadprimera.replace(".", ""));
                                $("#numeros_productos").val($("#numeros_productos").val() + cont + ",");
                            }
                        });
                        $("#lista_Drogas").html(texto);
                        $("#label_total_extra").html("Total compra calidad extra: $ " + formato_numero(totalPedidoExtra, 2, ",", "."));
                        $("#label_total_primera").html("Total compra calidad de primera: $ " + formato_numero(totalPedidoPrimera, 2, ",", "."));
                        if (cont % 5 == 0) {
                            ultima_pagina = pagina - 1;
                        }
                        else {
                            ultima_pagina = pagina;
                        }

                        numero_items = cont;


                        $('#lista_Drogas .todas').hide();
                        $('#lista_Drogas .' + primera_pagina).show();

                        if (cont < 5) {
                            $('#label_registros').html("Productos 1 a " + cont + " de " + cont);
                        }
                        else {
                            $('#label_registros').html("Productos 1 a " + 5 * pagina_actual + " de " + cont);
                        }
                        $('#flechas_paginacion_izq').hide();
                        if (ultima_pagina < 2) {

                            $('#flechas_paginacion_der').hide();
                        }
                        else {
                            $('#flechas_paginacion_der').show();
                        }
                        if (cont == 0) {
                            $('#mensaje_sinregistros').show();
                            $('#flechas_paginacion').hide();
                            $("#label_registros").css("display", "none");
                        }
                        else {
                            $('#mensaje_sinregistros').hide();
                            $('#flechas_paginacion').show();
                            $("#label_registros").css("display", "block");
                        }
                        $('.deploy-toggle-2').click(function () {
                            $(this).parent().find('.toggle-content').toggle(100);
                            $(this).toggleClass('toggle-2-active');
                            return false;
                        });

                    });

                },
                error: function (x, y, z) {
                    if (y == "timeout") {

                    }
                },
                timeout: 15000
            });
        }

        function paginarSiguiente() {
            if (pagina_actual != ultima_pagina) {
                $('#lista_Drogas .todas').hide();
                pagina_actual = pagina_actual + 1;
                $('#lista_Drogas .' + pagina_actual).show();
                if (pagina_actual == ultima_pagina) {
                    $('#flechas_paginacion_der').hide();
                    $('#flechas_paginacion_izq').show();
                }
                else {
                    $('#flechas_paginacion_der').show();
                    $('#flechas_paginacion_izq').show();
                }
                items_pagina = (5 * (pagina_actual - 1)) + 1;
                if (pagina_actual == ultima_pagina) {
                    items_final = numero_items;
                }
                else {
                    items_final = 5 * pagina_actual;
                }
                $('#label_registros').html("Productos " + items_pagina + " a " + items_final + " de " + cont);
            }
        }

        function paginarAnterior() {
            if (pagina_actual != primera_pagina) {
                $('#lista_Drogas .todas').hide();
                pagina_actual = pagina_actual - 1;
                $('#lista_Drogas .' + pagina_actual).show();
                items_pagina = (5 * (pagina_actual - 1)) + 1;
                if (pagina_actual == primera_pagina) {
                    $('#flechas_paginacion_izq').hide();
                    $('#flechas_paginacion_der').show();
                }
                else {
                    $('#flechas_paginacion_izq').show();
                    $('#flechas_paginacion_der').show();
                }
                if (pagina_actual == 1) {
                    items_final = 5;
                }
                else {
                    items_final = 5 * pagina_actual;
                }
                $('#label_registros').html("Productos " + items_pagina + " a " + items_final + " de " + cont);
            }
        }

        function formato_numero(numero, decimales, separador_decimal, separador_miles) { // v2007-08-06
            numero = parseFloat(numero);
            if (isNaN(numero)) {
                return "";
            }

            if (decimales !== undefined) {
                // Redondeamos
                numero = numero.toFixed(decimales);
            }

            // Convertimos el punto en separador_decimal
            numero = numero.toString().replace(".", separador_decimal !== undefined ? separador_decimal : ",");

            if (separador_miles) {
                // Añadimos los separadores de miles
                var miles = new RegExp("(-?[0-9]+)([0-9]{3})");
                while (miles.test(numero)) {
                    numero = numero.replace(miles, "$1" + separador_miles + "$2");
                }
            }

            return numero;
        }

        $(document).ready(function () {
            //localStorage["MisProductos"] = "ACELGA,CALABACIN,COLIFLOR";
            cargar_listaDrogas();
        });
                
    </script>
    <style>
        .submenu-nav-items a
        {
            padding-left: 20px !important;
            padding-top: 10px !important;
            padding-bottom: 10px !important;
            border-bottom: solid 1px rgba(0,0,0,0.1) !important;
        }
        
        .vinculo_derecha
        {
            float: right;
            padding-right: 1%;
        }
        
        .vinculo_izquierda
        {
            float: left;
            padding-left: 1%;
            display: none;
        }
        
        .CargandoModalBackground
        {
            overflow: hidden;
            background-color: #0D0D0D;
            filter: alpha(opacity=80);
            opacity: 0.8;
            position: fixed;
            top: 0px;
            left: 0px;
            text-align: center;
            vertical-align: middle;
            padding-bottom: 51% !important;
            padding-left: 47%;
            padding-right: 51%;
            width: 100%;
            height: 100%;
            display: none;
            z-index: 9999;
        }
    </style>
</body>
</html> 